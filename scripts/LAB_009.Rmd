---
title: "LAB_0xx"
author: "Mike James"
date: "4/1/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(nlme)
data <- read.csv("Downloads/turtles.rep.measures.csv",sep = ",")
attach(data)
data
```

Assumption of equal or zero covariance:
variation among individuals
variation within individuals
Random distribution between all treatments

*Repeated measures* are used or implemented with the lme that resides in the nlme package and this package comes standard when you install rstudio so you don't need to call it up.

Alternative, he prefers to call it up because it makes you remember things.

So start the statement as

**the function lma resides in the package nlme**

> lme(linear mixed effects) 
> nlme(non-linear and linear mixed effect)

The measure we will use is a ML (maximum likelihood) method.

y is a function of x times something else.

An example:

```{r}
turtles.lme <- lme(blood.plasma~sex*ordered(diet), random=~1|subject, data=data, method="ML")
anova(turtles.lme) 
```

Random always comes before discrete effect.  

***

### Nested ANOVAs

* Description - Fit an analysis of variance model by a call to *lm* for each stratum

```{r}
cage <- rep(c("Cage1","Cage2","Cage3"),c(8,8,8))
individual <- factor(rep(rep(1:4,c(2,2,2,2)), 3))
wing <- c(58.5, 59.5, 77.8, 80.9, 84.0,
83.6, 70.1, 68.3, 69.8, 69.8, 56.0,
54.5, 50.7, 49.3, 63.8, 65.8, 56.6,
57.5, 77.8, 79.2, 69.9, 69.2, 62.1,
64.5)
(mosquito <- data.frame(cage,
individual, wing))
mosquito.nest.aov<-aov(wing~cage/individual,data=mosquito)
summary(mosquito.nest.aov)
```

The above is incorrect; below is the corrected version.

```{r}
(cage.F <- 332.84/191.19)
(cage.p <- pf(1.740886, 2, 9, lower.tail=F))
```

When you see a single nested ???? it is appropriate to divide by the residuals.  

cage/individual is a *change in scale*  

lower.tail = F is forcing the use of **only** the upper.tail.

Here the difference is much smaller (1.7X vs. 255X) and went from very significant to *not* significant.

***
```{r}
nested.example <- read.csv("Downloads/nested.example.csv", sep = ",")
summary(nested.example)
(nested.example.aov <- aov(drug.concentration~treatment/individual/organ/sample, data = nested.example))
summary(nested.example.aov)
```

Of course, this is -- again -- wrong.

Devide the *higher* by the one *just below* it so as to avoid combining variances(?)

##### Nested design with sampling error

```{r}
(nested..treatment.F <- (30.011/0.234))
(nested..individual.F <- (0.234/0.481))
(nested..organ.F <- (0.481/.131))

(F.treatment.p <- pf(nested..treatment.F, 2, 3, lower.tail=F)) 
(F.individual.p <- pf(nested..individual.F, 3, 6, lower.tail=F)) 
(F.organ.p <- pf(nested..organ.F, 6, 9, lower.tail=F)) 
```

A nested ANOVA with repeated measures...  

##### YOU NEED TO DEFINE THE SCALES
##### YOU NEED TO DETERMINE WHAT IS NESTED WITHIN WHAT

If you're following a nested design over time... (pointless tangent [we won't cover this, nor do textbooks])

Used for split-plot, latin-squares... 

